!function(){"use strict";document.querySelectorAll(".smi-image-uploader").forEach(function(e){!function(e){const t=e.querySelector("#smi-dropzone"),n=e.querySelector("#smi-file-input"),i=e.querySelector("#smi-browse-button"),o=e.querySelector("#smi-upload-zone"),r=e.querySelector("#smi-preview-zone"),l=e.querySelector("#smi-preview-image"),s=e.querySelector("#smi-remove-image"),c=e.querySelector("#smi-image-dimensions"),a=e.querySelector("#smi-resolution-picker"),u=e.querySelector("#smi-email-section"),d=e.querySelector("#smi-email-input"),p=e.querySelector("#smi-checkout-section"),m=e.querySelector("#smi-checkout-button"),y=e.querySelector("#smi-loading"),f=e.querySelector("#smi-loading-text"),g=e.querySelector("#smi-error"),h=e.querySelector("#smi-error-text");let v=null,x=null;const S=1024*parseInt(e.dataset.maxFileSize||10,10)*1024;function q(t){if(!["image/jpeg","image/png","image/webp"].includes(t.type))return void L("Please upload a JPEG, PNG, or WebP image.");if(t.size>S)return void L("File size exceeds "+S/1024/1024+"MB limit.");const n=new FileReader;n.onload=function(e){l.src=e.target.result},n.readAsDataURL(t),function(t){b("Uploading..."),P();const n=new FormData;n.append("image",t),fetch("/wp-json/smi/v1/upload-image",{method:"POST",body:n}).then(function(e){return e.json()}).then(function(t){var n;w(),t.success?(v=t.upload_id,x=t.pricing,n=t.image_info,o.style.display="none",r.style.display="block",c.textContent=n.width+" × "+n.height+" px",x&&function(){const t=e.querySelector("#smi-output-4x"),n=e.querySelector("#smi-output-8x"),i=e.querySelector("#smi-price-4x"),o=e.querySelector("#smi-price-8x");x["4x"]&&(t.textContent=x["4x"].output_width+" × "+x["4x"].output_height+" px",i.textContent="$"+x["4x"].price.toFixed(2)),x["8x"]&&(n.textContent=x["8x"].output_width+" × "+x["8x"].output_height+" px",o.textContent="$"+x["8x"].price.toFixed(2))}(),a.style.display="block",u.style.display="block",p.style.display="block"):(L(t.message||"Upload failed. Please try again."),C())}).catch(function(e){w(),L("Upload failed. Please try again."),C()})}(t)}function k(){const t=e.querySelector('input[name="smi-resolution"]:checked').value,n=x&&x[t]?x[t].price:0;m.textContent="Checkout - $"+n.toFixed(2)}function C(){v=null,x=null,n.value="",l.src="",d.value="",o.style.display="block",r.style.display="none",a.style.display="none",u.style.display="none",p.style.display="none",e.querySelector('input[name="smi-resolution"][value="4x"]').checked=!0,m.textContent="Proceed to Checkout",P(),w()}function b(e){f.textContent=e,y.style.display="flex"}function w(){y.style.display="none"}function L(e){h.textContent=e,g.style.display="block"}function P(){g.style.display="none"}i.addEventListener("click",function(){n.click()}),n.addEventListener("change",function(e){e.target.files.length>0&&q(e.target.files[0])}),t.addEventListener("dragover",function(e){e.preventDefault(),t.classList.add("smi-dragover")}),t.addEventListener("dragleave",function(e){e.preventDefault(),t.classList.remove("smi-dragover")}),t.addEventListener("drop",function(e){e.preventDefault(),t.classList.remove("smi-dragover"),e.dataTransfer.files.length>0&&q(e.dataTransfer.files[0])}),s.addEventListener("click",C),m.addEventListener("click",function(){if(!v)return void L("Please upload an image first.");const t=e.querySelector('input[name="smi-resolution"]:checked').value,n=d.value.trim();b("Creating checkout..."),P();const i={upload_id:v,resolution:t};n&&(i.email=n),fetch("/wp-json/smi/v1/create-checkout-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){w(),e.success&&e.checkout_url?window.location.href=e.checkout_url:L(e.message||"Checkout failed. Please try again.")}).catch(function(e){w(),L("Checkout failed. Please try again.")})}),e.querySelectorAll('input[name="smi-resolution"]').forEach(function(e){e.addEventListener("change",k)}),k()}(e)})}();